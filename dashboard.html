<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - جهاز معلومات شبكات المرافق</title>
<style>
body { margin:0; font-family:sans-serif; direction:rtl; }

/* الهيدر */
header {
  background:#004b8d;
  color:white;
  padding:15px 25px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  position: fixed;
  top:0;
  left:0;
  right:0;
  z-index: 1001;
}
header span { font-weight:bold; }
header a { color:white; text-decoration:none; font-weight:bold; margin-left:15px; z-index:1002; }

/* القائمة الجانبية */
.sidebar {
  width:220px;
  background:#2c3e50;
  color:white;
  position:fixed;
  top:70px;
  left:0;
  height:calc(100% - 70px);
  padding:20px;
  overflow-y:auto;
}
.sidebar a { color:white; text-decoration:none; display:block; margin:12px 0; }
.sidebar a:hover { background:#34495e; padding-left:5px; }

/* المحتوى الرئيسي */
.main-content {
  margin-top: 70px;
  margin-left:240px;
  padding:30px;
}

/* لوحة التحكم للادمن */
#adminControl, #accountControl, #visitsControl {
  margin-top:20px;
  padding:10px;
  border:1px solid #ccc;
  background:#f8f8f8;
  border-radius:5px;
}
#adminControl input, #accountControl input { width:70%; padding:8px; margin-right:5px; }
#adminControl button, #accountControl button { padding:8px; margin-top:5px; cursor:pointer; }

/* بطاقات الصور */
.image-card { display:inline-block; margin:10px; text-align:center; }
.image-card img { width:150px; height:100px; object-fit:cover; display:block; }
.image-card button { margin-top:5px; padding:5px; cursor:pointer; }

/* شارت الزيارات */
#visitsChart { width:100%; max-width:600px; height:300px; }

/* Footer ثابت */
footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(90deg,#00b09b,#96c93d);
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-weight: 700;
  padding: 6px 0;
  z-index: 1000;
}
footer .line2 { font-weight: 600; font-size: 13px; margin-top: 2px; }

  #adminAccounts input, #adminAccounts select {
  padding: 6px;
  margin-right: 5px;
}

#usersList div {
  margin: 5px 0;
  padding: 5px;
  background: #34495e;
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#usersList button {
  padding: 3px 6px;
  cursor: pointer;
}

</style>
</head>
<body>

<header>
  <div>مرحبا، <span id="userName"></span></div>
  <nav>
    <a href="#" id="logoutLink">تسجيل الخروج</a>
  </nav>
</header>

<div class="sidebar">
  <a id="adminMenu" href="#">لوحة التحكم (Admin)</a>
  <a id="userMenu" href="#">صفحات المستخدم</a>
  <a id="guestMenu" href="#">صفحة الضيف</a>
  <a href="Government-Departments-Complex.html">صفحة الخريطة الرئيسية</a>
</div>

<div class="main-content">
  <h2>لوحة التحكم</h2>
  
  <!-- واجهة Admin لإدارة الصور -->
  <div id="adminControl" style="display:none;">
    <h3 id="imageSectionTitle">إدارة الصور</h3>
    <!-- واجهة إدارة الحسابات -->
  <div id="adminAccounts" style="display:none; margin-top:20px;">
  <h3>إدارة الحسابات</h3>
  
  <!-- إضافة مستخدم جديد -->
  <input type="text" id="newUsername" placeholder="اسم المستخدم">
  <input type="password" id="newPassword" placeholder="كلمة المرور">
  <select id="newRole">
    <option value="admin">Admin</option>
    <option value="user">User</option>
    <option value="guest">Guest</option>
  </select>
  <button id="addUserBtn">إضافة مستخدم</button>

  <!-- قائمة الحسابات -->
  <h4>المستخدمون الحاليون</h4>
  <div id="usersList"></div>
</div>

    <input type="text" id="newImageURL" placeholder="رابط الصورة من الإنترنت">
    <input type="file" id="newImageFile" accept="image/*">
    <button id="addImageBtn">إضافة صورة</button>
    <div id="imagesContainer"></div>
  </div>

  <!-- واجهة Admin لإدارة الحسابات -->
  <div id="accountControl" style="display:none;">
    <h3 id="accountSectionTitle">إدارة الحسابات</h3>
    <input type="text" id="newUserName" placeholder="اسم المستخدم">
    <input type="password" id="newUserPass" placeholder="كلمة المرور">
    <select id="newUserRole">
      <option value="admin">Admin</option>
      <option value="user">User</option>
      <option value="guest">Guest</option>
    </select>
    <button id="createUserBtn">إنشاء حساب</button>
    <div id="accountsList"></div>
  </div>

  <!-- شارت الزيارات -->
  <div id="visitsControl" style="display:none;">
    <h3 id="visitsSectionTitle">زيارات المستخدمين</h3>
    <canvas id="visitsChart"></canvas>
  </div>

</div>

<footer>
  إعداد جهاز معلومات شبكات المرافق - محافظة الوادي الجديد
  <span class="line2">Designed By Eng. Ahmed Labib </span>
</footer>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="assets/js/auth.js"></script>
<script>
let sessionUser = JSON.parse(localStorage.getItem("loggedUser"));
if(!sessionUser){
  alert("يجب تسجيل الدخول أولاً");
  window.location.href = "index.html";
}
document.getElementById("userName").innerText = sessionUser.username;

// التحكم في ظهور القوائم حسب الصلاحية
if(sessionUser.role === "admin"){
  document.getElementById("adminMenu").style.display = "block";
  document.getElementById("userMenu").style.display = "block";
  document.getElementById("guestMenu").style.display = "block";
  document.getElementById("adminControl").style.display = "block";
  document.getElementById("accountControl").style.display = "block";
  document.getElementById("visitsControl").style.display = "block";
}else if(sessionUser.role === "user"){
  document.getElementById("adminMenu").style.display = "none";
  document.getElementById("userMenu").style.display = "block";
  document.getElementById("guestMenu").style.display = "block";
}else{
  document.getElementById("adminMenu").style.display = "none";
  document.getElementById("userMenu").style.display = "none";
  document.getElementById("guestMenu").style.display = "block";
}

// تسجيل الخروج
document.getElementById("logoutLink").onclick = function(){
  localStorage.removeItem("loggedUser");
  window.location.href = "index.html";
};

// ======= شارت الزيارات =======
const ctx = document.getElementById('visitsChart').getContext('2d');
const visitsChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Admin', 'User1', 'Guest'],
        datasets: [{
            label: 'عدد الزيارات',
            data: [12, 19, 7],
            backgroundColor: ['#004b8d','#2c3e50','#96c93d']
        }]
    }
});
  // ------------------ إدارة الحسابات ------------------
const accountsKey = "siteUsers"; // المفتاح في localStorage

// تهيئة المستخدمين إذا لم يكن موجودين
if(!localStorage.getItem(accountsKey)){
  localStorage.setItem(accountsKey, JSON.stringify(users));
}

// اظهار واجهة الحسابات للادمن
if(sessionUser.role === "admin"){
  document.getElementById("adminAccounts").style.display = "block";
}

// تحميل الحسابات وعرضها
function loadUsers() {
  const userListDiv = document.getElementById("usersList");
  const allUsers = JSON.parse(localStorage.getItem(accountsKey));
  userListDiv.innerHTML = "";
  allUsers.forEach((u, index) => {
    const div = document.createElement("div");
    div.innerHTML = `
      ${u.username} (${u.role})
      <span>
        <button onclick="deleteUser(${index})">حذف</button>
        <button onclick="changePassword(${index})">تغيير كلمة المرور</button>
      </span>
    `;
    userListDiv.appendChild(div);
  });
}
loadUsers();

// إضافة مستخدم جديد
document.getElementById("addUserBtn").onclick = function(){
  const username = document.getElementById("newUsername").value.trim();
  const password = document.getElementById("newPassword").value;
  const role = document.getElementById("newRole").value;

  if(!username || !password){ alert("املأ جميع الحقول"); return; }

  const allUsers = JSON.parse(localStorage.getItem(accountsKey));
  if(allUsers.find(u=>u.username===username)){ alert("اسم المستخدم موجود مسبقاً"); return; }

  allUsers.push({username, password, role});
  localStorage.setItem(accountsKey, JSON.stringify(allUsers));

  document.getElementById("newUsername").value = "";
  document.getElementById("newPassword").value = "";
  loadUsers();
};

// حذف مستخدم
function deleteUser(index){
  if(!confirm("هل تريد حذف هذا المستخدم؟")) return;
  const allUsers = JSON.parse(localStorage.getItem(accountsKey));
  allUsers.splice(index,1);
  localStorage.setItem(accountsKey, JSON.stringify(allUsers));
  loadUsers();
}

// تغيير كلمة المرور
function changePassword(index){
  const allUsers = JSON.parse(localStorage.getItem(accountsKey));
  const newPass = prompt("ادخل كلمة المرور الجديدة:", allUsers[index].password);
  if(newPass){
    allUsers[index].password = newPass;
    localStorage.setItem(accountsKey, JSON.stringify(allUsers));
    loadUsers();
  }
}

</script>
</body>
</html>
